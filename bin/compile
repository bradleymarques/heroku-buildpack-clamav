#!/usr/bin/env bash
# bin/compile build_path cache_path

build="$1"
echo "build=$build"
cache="$2"
echo "cache=$cache"

set -e
mkdir -p "${cache}/clamav-data"
# Override the specified datadir so we retain changes via the cache.

mkdir ${build}/clamav
touch ${build}/clamav/freshclam.conf

echo "# /usr/local/etc/clamav/freshclam.conf" >> ${build}/clamav/freshclam.conf
echo "DatabaseMirror database.clamav.net" >> ${build}/clamav/freshclam.conf

freshclam --config-file="${build}/clamav/freshclam.conf" --datadir="${cache}/clamav-data/" --log=/dev/stdout
rm -rf "${build}/.clamav-data"
cp -rp "${cache}/clamav-data" "${build}/.clamav-data"
